#	Install dependencies 
To run the BTCPayServer you will need to install .NET Core SDK, NBXplorer and PostgreSQL.

#### .NET Core SDK (installation)
```bash
$ wget -q https://packages.microsoft.com/config/ubuntu/18.04/packages-microsoft-prod.deb
$ sudo dpkg -i packages-microsoft-prod.deb
$ sudo apt-get install apt-transport-https
$ sudo apt-get update
$ sudo apt-get install -y dotnet-sdk-3.1
```
#### .NET Core SDK (check)
```bash
$ dotnet --info
```
 
#### PostgreSQL (installation)
```bash
$ sudo apt install postgresql postgresql-contrib
```

#### PostgreSQL (check)
```bash
$ psql --version
$ sudo systemctl status postgresql
$ sudo -u postgres psql
```

 
#### NBXplorer (installation)
```bash
$ cd ~
$ git clone https://github.com/dgarage/NBXplorer
$ cd NBXplorer
$ git checkout latest
$ ./build.sh
```
 


####	Adapt UFW config

```bash
$ sudo apt install ufw #(Installation)
$ sudo su #(Mode admin)
$ ufw allow <port> comment <Nom du port> # (Acceptation des ports)

$ ufw enable / systemctl enable ufw #(Reboot)
$ ufw status #(Checker les ports)
$ exit
```


#	Adapt SSH config

Put host name or IP
(Connection type) SSH
saved Sessions -> load -> save
connection -> SSH -> Auth -> put private_key was generated by Puttygen
save
Open Session
```bash
$ sudo nano .ssh/authorized_keys
```
We paste our ssh-rsa pubkey in the file. We can paste multiple keys.

We can then Restart the SSH daemon, then exit and log in again.
```bash
$ sudo systemctl restart sshd
$ exit
```

#	Install BTC Pay server
BTCPayServer(Installation)
```bash
$ cd ~
$ git clone https://github.com/btcpayserver/btcpayserver.git
$ cd btcpayserver
$ git checkout latest
$ ./build.sh
$ ./run.sh -h
```


#### Configuration de Bitcoin testnet
```bash
$ sudo adduser bitcoin
$ sudo adduser administrateur1
$ sudo su - bitcoin
$ nvim ~/.bitcoin/bitcoin.conf 
```
=> insérer
```bash 
[
daemon=1
testnet=1
server=1
txindex=1

listen=1
listenonion=1

rpcuser= #nom utilisateur
rpcpassword= #mot de passe
zmqpubrawblock=tcp://127.0.0.1:28332
zmqpubrawtx=tcp://127.0.0.1:28332
]
```
```bash
$ bitcoind #lancer le réseau
```

#	Configure your BTC Pay server

#### Configuration du BTCPayServeur

```bash
$ mkdir -p ~/.btcpayserveur/Main
$ cd ~/.btcpayserver/Main
$ sudo vi settings.config
```
Paste in settings.config
```bash
[
network=testnet
port=23001
bind=0.0.0.0
chains=btc
BTC.explorer.url=http://127.0.0.1:24445
BTC.lightning=type=lnd-rest;server=https://127.0.0.1:8080/;macaroonfilepath=~/.lnd/data/chain/bitcoin/testnet/admin.macaroon;certthumbprint= #LND's_certificate_fingerprint
postgres=User ID= #Postgres_DatabaseName;Password=#Prosgrs_DatabassePssw;Host=localhost;Port=5432;Database=btcpayserver;
]
```

Get LND fingerprint => 
```bash
$ openssl x509 -noout -fingerprint -sha256 -inform pem -in ~/.lnd/tls.cert
```

Get Database Postgres => DatabaseName + DatabasePssw
 
Check Configuration
```bash
$ usr/bin/dotnet run -p ~i/source/btcpayserver/BTCPayServer/BTCPayServer.csproj -c ~/.btcpayserver/Main/settings.config --network=testnet
```

Lauch BTCPayServer
```bash
$ sudo systemctl enable btcpayserver.service
$ sudo service btcpayserver start
$ sudo service btcpayserver status
```

#	Install website / Wordpress
Install PHP and Apache:
```bash
$ sudo apt update
$ sudo apt install apache2 \
                 ghostscript \
                 libapache2-mod-php \
                 mysql-server \
                 php \
                 php-bcmath \
				 php-curl \
                 php-imagick \
                 php-intl \
                 php-json \
                 php-mbstring \
                 php-mysql \
                 php-xml \
                 php-zip
```

Then install Wordpress:
```bash
$ sudo mkdir -p /srv/www
$ sudo chown www-data: /srv/www
$ curl https://wordpress.org/latest.tar.gz | sudo -u www-data tar zx -C /srv/www
```

To configure WordPress, we need to create MySQL database =>
```bash
$ sudo mysql -u root
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 7
Server version: 5.7.20-0ubuntu0.16.04.1 (Ubuntu)

Copyright (c) 2000, 2017, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> CREATE DATABASE wordpress;
Query OK, 1 row affected (0,00 sec)

mysql> CREATE USER wordpress@localhost IDENTIFIED BY '<your-password>';
Query OK, 1 row affected (0,00 sec)

mysql> GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP,ALTER
    -> ON wordpress.*
    -> TO wordpress@localhost;
Query OK, 1 row affected (0,00 sec)

mysql> FLUSH PRIVILEGES;
Query OK, 1 row affected (0,00 sec)

mysql> quit
Bye
```

Enable MySQL:
```bash
$ sudo service mysql start.
```
Then configure WordPress to use this database.
Copy the sample configuration file to wp-config.php:
```bash
$ sudo -u www-data cp /srv/www/wordpress/wp-config-sample.php /srv/www/wordpress/wp-config.php
```

Next, set the database credentials in the configuration file (do not replace database_name_here or username_here in the commands below. Do replace <your-password> with your database password.):
```bash
$ sudo -u www-data sed -i 's/database_name_here/wordpress/' /srv/www/wordpress/wp-config.php
$ sudo -u www-data sed -i 's/username_here/wordpress/' /srv/www/wordpress/wp-config.php
$ sudo -u www-data sed -i 's/password_here/<your-password>/' /srv/www/wordpress/wp-config.php
```

Finally, open the configuration file in nano:
```bash
$ sudo -u www-data nano /srv/www/wordpress/wp-config.php
```

Find the following:
```bash
define( 'AUTH_KEY',         'put your unique phrase here' );
define( 'SECURE_AUTH_KEY',  'put your unique phrase here' );
define( 'LOGGED_IN_KEY',    'put your unique phrase here' );
define( 'NONCE_KEY',        'put your unique phrase here' );
define( 'AUTH_SALT',        'put your unique phrase here' );
define( 'SECURE_AUTH_SALT', 'put your unique phrase here' );
define( 'LOGGED_IN_SALT',   'put your unique phrase here' );
define( 'NONCE_SALT',       'put your unique phrase here' );
```

Delete those then replace with the content of [this link](https://api.wordpress.org/secret-key/1.1/salt/.)
Save and close the configuration file.
Open your server url and follow instruction to configure the wordpress website. 
We can modify the website thanks to the dashboard.

#	Documentation
https://stadicus.github.io/RaspiBolt
https://docs.btcpayserver.org/ManualDeployment/
https://freedomnode.com/blog/how-to-setup-btc-and-lightning-payment-gateway-with-btcpayserver-on-linux-manual-install/
https://ubuntu.com/tutorials/install-and-configure-wordpress#1-overview


